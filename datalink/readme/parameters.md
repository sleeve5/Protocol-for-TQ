# Proximity-1 仿真系统参数配置指南

本仿真系统涉及 **物理层 (PHY)**、**编码与同步子层 (C&S)** 以及 **数据链路层 (DLL)** 的多层级参数。参数设置直接影响仿真结果的正确性与系统性能。

## 1. 物理层与信道参数 (Physical Layer & Channel)

这部分参数决定了信号的物理特性和传输环境，需根据具体的任务场景（如 LISA 星间链路）进行设置。

| 参数名        | 变量名                 | 推荐设置 (LISA场景)     | 设置依据与分析                                                                                        |
|:---------- |:------------------- |:----------------- |:---------------------------------------------------------------------------------------------- |
| **采样率**    | `fs`                | **100 MHz**       | 必须满足奈奎斯特采样定理。对于 3.125 Mcps 的伪码，100 MHz 提供了约 32 倍过采样，保证了波形精度和测距分辨率。                             |
| **伪码速率**   | `prn_rate`          | **3.125 Mcps**    | DSSS 扩频码速率。决定了信号带宽和测距精度（1个码片对应 $\approx$ 96米）。                                                 |
| **物理数据速率** | `PHY_DATA_RATE`     | **195.3125 kbps** | $\text{Rate} = \text{ChipRate} / \text{SpreadingFactor}$。在扩频比为 16 时得出此值。需确保 C&S 层的吞吐量不超过此物理瓶颈。 |
| **扩频因子**   | `spreading_factor`  | **16**            | 决定扩频增益 $G_p = 10\log_{10}(16) \approx 12 \text{dB}$。扩频比越高，抗干扰越强，但数据率越低。                        |
| **通信距离**   | `REAL_DISTANCE`     | **170,000 km**    | LISA 卫星间典型距离。直接决定了单向光行时延迟 ($\approx 0.57$s)。                                                   |
| **调制深度**   | `b`                 | **0.5**           | 相位调制指数。0.5 代表约 0.5 rad 的相位偏移。值越大，信号边带能量越强，解调越容易，但载波残留越少（影响 PLL）。                               |
| **激光频率**   | `remote_laser_freq` | **281.95 THz**    | 1064 nm 激光。仿真中主要关注频差（拍频）。                                                                      |
| **多普勒频偏**  | `doppler_freq`      | **2 MHz**         | 模拟卫星相对运动产生的频移。接收机 PLL 必须具备捕获此频偏的能力。                                                            |
| **信噪比**    | `EbN0_dB`           | **0 ~ 10 dB**     | 仿真变量。LDPC (Rate 1/2) 的工作门限约在 1.5 dB。通常设为 4.0 dB 以保证无误码。                                        |

---

## 2. 编码与同步子层参数 (C&S Sublayer)

这部分参数定义了信道编码的结构和同步机制，必须严格遵循 **CCSDS 211.2-B-3** 和 **131.0-B-5** 标准。

| 参数名         | 变量名             | 推荐设置                 | 设置依据与分析                                                                       |
|:----------- |:--------------- |:-------------------- |:----------------------------------------------------------------------------- |
| **编码类型**    | `CodingType`    | **2 (LDPC)**         | 针对深空通信的最佳选择，性能优于卷积码。                                                          |
| **LDPC 码率** | `CODE_RATE`     | **1/2**              | CCSDS C2 码族的标准码率。抗噪能力最强，但带宽效率最低（1 bit 信息 = 2 bit 符号）。                         |
| **信息块长**    | `K_INFO`        | **1024 bits**        | 标准规定的 C2 码信息长度。必须与帧长适配。                                                       |
| **码字长度**    | `N_CODED`       | **2048 bits**        | 经过打孔（Puncturing）后的传输长度。原生成矩阵输出为 2560 bits，必须丢弃最后 512 bits。                    |
| **CSM 长度**  | -               | **64 bits**          | 码字同步标志。对于 LDPC Rate 1/2，标准强制使用 64 位 CSM 以确保低信噪比下的同步可靠性。                       |
| **ASM 长度**  | -               | **24 bits**          | 传送帧同步标志。标准固定为 `0xFAF320`。                                                     |
| **捕获序列长度**  | `AcqSeqLen`     | **1024 ~ 4096 bits** | **关键调优点**。用于唤醒接收机 PLL 和 DLL。在低信噪比或大频偏（2MHz）下，必须足够长（例如 >2048）以确保物理层锁定，否则会导致丢包。 |
| **尾序列长度**   | `TailSeqLen`    | **128 bits**         | 确保最后一个码块完全移出解码器。128 位通常足够。                                                    |
| **帧间隙**     | `InterFrameGap` | **64 bits**          | 可选。在连续传输中插入少量空闲位，有助于接收机状态机复位，防止粘包误判。                                          |
| **同步门限**    | `CSM_Threshold` | **4 ~ 8 bits**       | **关键调优点**。在 64 位 CSM 中允许错误的比特数。设太低（如 0）会导致漏检；设太高（如 20）会导致虚警（误锁噪声）。推荐值 5 左右。   |

---

## 3. 数据链路层参数 (Data Link Layer)

这部分参数控制 ARQ 协议（COP-P）的行为，需根据物理层的延迟（RTT）进行适配。

| 参数名        | 变量名                   | 推荐设置           | 设置依据与分析                                                                           |
|:---------- |:--------------------- |:-------------- |:--------------------------------------------------------------------------------- |
| **最大帧长**   | `Max_Frame_Length`    | **2048 Bytes** | 标准允许的最大值。在长延迟链路中，**建议使用大帧**（如 1024 字节以上），以提高序列号窗口的利用率。                            |
| **发送窗口**   | `Transmission_Window` | **64**         | **关键调优点**。限制未确认帧的数量。必须 $< 127$。对于 17万公里链路，计算出的 BDP 约为 14 帧（大帧），设为 64 留有充足余量，防止阻塞。 |
| **ACK 超时** | `Synch_Timeout`       | **> 3.0 s**    | FOP-P 等待 ACK 的时间。必须大于 $RTT \approx 1.14s$。建议设为 3-5 秒。设太短会导致不必要的重传，设太长会导致故障恢复慢。    |
| **呼叫超时**   | `Hail_Wait_Duration`  | **> 3.0 s**    | MAC 层握手等待时间。同上，必须大于 RTT。                                                          |
| **序列号范围**  | `SeqNo`               | **0 ~ 255**    | 标准规定 8-bit。注意：在高速率、小帧长、长延迟场景下，序列号可能会在 1 个 RTT 内回绕（Wrap-around），这是协议的物理限制。         |

---

## 4. 仿真控制参数 (Simulation Control)

这部分参数控制仿真脚本本身的运行逻辑，不影响协议，但影响结果的统计精度。

| 参数名        | 变量名              | 推荐设置          | 设置依据与分析                                              |
|:---------- |:---------------- |:------------- |:---------------------------------------------------- |
| **最小错误数**  | `min_errors`     | **50 ~ 100**  | 蒙特卡洛仿真中，收集到足够多的错误样本才能保证 BER/FER 的统计置信度（95%）。         |
| **最大块数**   | `max_blocks`     | **10,000+**   | 防止在无误码区死循环。足以测量到 $10^{-5}$ 级别的误码率。                   |
| **物理分片大小** | `PHY_CHUNK_SIZE` | **256 ~ 512** | 模拟硬件 FIFO 的读取粒度。用于验证流式接收机的鲁棒性。值越小，碎片化越严重，对状态机逻辑考验越大。 |

---

## 5. 关键参数设置建议总结

1. **为了通过测试**：
   
   * `AcqSeqLen` 设大一点（1024+），保证物理层锁定。
   * `Synch_Timeout` 设大一点（3s+），防止长延迟导致的假超时。
   * `CSM_Threshold` 设适中（4-8），防止低信噪比下的虚警或漏检。

2. **为了性能最优**：
   
   * 使用 **大帧**（> 1KB），提高有效载荷占比，降低头部开销，并避免序列号窗口阻塞。
   * `Transmission_Window` 设为 **BDP 的 2-3 倍**（例如 64），既保证流水线跑满，又限制重传代价。

3. **LISA 特异性**：
   
   * 由于 17万公里延迟显著，**必须** 关注 Timer 的设置。标准默认的 Timer 值（通常针对火星轨道器，几百公里）在这里完全不适用，必须手动覆盖。
